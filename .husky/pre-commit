#!/usr/bin/env sh

# Fast, non-interactive checks only; keep this lightweight and cross-platform friendly.

# 1) Type-check
npm run type-check || exit 1

# 2) Color guardrails (staged-only): fail on new raw hex or forbidden Tailwind palettes in staged TS/TSX
STAGED=$(git diff --cached --name-only --diff-filter=ACM | grep -E '^src/.*\.(ts|tsx)$' || true)
if [ -n "$STAGED" ]; then
  echo "$STAGED" | xargs -r -I {} sh -c "grep -nE '#[0-9a-fA-F]{3,6}\b' {} | grep -vE '\\.svg$' && echo ❌ Hex in {} && exit 1" || true
  if echo "$STAGED" | xargs -r grep -nE '\b(bg|text|border)-(red|blue|yellow|orange|slate|green|gray|emerald|stone)-[0-9]{2,3}\b' >/dev/null; then
    echo "❌ Forbidden Tailwind palette classes found in staged changes — use semantic tokens." >&2
    exit 1
  fi
fi

exit 0
